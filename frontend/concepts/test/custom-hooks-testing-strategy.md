# 📌 커스텀 훅(Custom Hook) 테스트 전략

이 문서는 커스텀 훅(`useXXX`)을 테스트하는 목적, 시나리오 구성 방식, 예시 등을 담고 있습니다.

---

## ✅ 1. 커스텀 훅 테스트의 목적

- 커스텀 훅은 UI가 없는 **로직 단위의 재사용성**을 위한 기능입니다.
- 컴포넌트 단위 테스트만으로는 **로직 분기**, **상태 변화**, **콜백 호출 여부**를 충분히 검증하지 못할 수 있음.
- 따라서 커스텀 훅 자체를 단위로 테스트하면 **UI와 로직을 분리한 테스트가 가능**하며 유지보수가 쉬워집니다.

---

## ✅ 2. 어떤 훅을 테스트해야 할까?

다음 중 하나에 해당하는 경우 테스트가 권장됩니다:

- 외부 입력(state, props 등)에 따라 분기되는 로직이 있는 훅
- 콜백 함수를 외부로 전달하거나 상태를 변경하는 훅
- 시간, 좌표, 포지션 등의 계산 로직이 포함된 훅
- 네트워크 요청 등 사이드이펙트를 포함하는 훅 (mock 처리 필수)

---

## ✅ 3. 테스트 가능한 시나리오 기준

커스텀 훅 테스트는 **입력 → 처리 → 출력/동작**의 관점에서 구성합니다.

| 유형         | 예시                                                 |
|--------------|------------------------------------------------------|
| State 변화    | 특정 조건에서 setState가 호출되는지                 |
| Callback 호출 | 외부에서 전달받은 onXXX 함수가 조건에 따라 호출됨 |
| 계산 결과     | 좌표, 시간 등의 계산 결과가 정확히 반환되는지      |
| 부작용 방지   | 특정 조건에서는 아무런 동작도 발생하지 않아야 함  |

---

## ✅ 4. 테스트 구조 설계 방법

테스트는 보통 아래 구조를 따릅니다:

1. 훅을 실행하기 위해 `renderHook` 사용
```ts
const { result } = renderHook(() => useMyHook(...));
```

2. 필요 시 `act()`로 상태 변경 유도
```ts
act(() => result.current.doSomething());
```

3. 외부 함수가 호출되었는지 확인
```ts
expect(mockFn).toHaveBeenCalledWith(expectedArgs);
```

4. 내부 계산 결과를 비교
```ts
expect(result.current.value).toBe(expected);
```

---

## ✅ 5. 예시: useScheduleDraft

### 🔹 훅 기능 요약

사용자가 타임 그리드 셀을 클릭하면, 클릭 위치에 따라 `startTime`, `endTime`을 계산하여 새 카드 초안을 만든다.  
단, 이미 생성 중인 카드가 있다면 추가되지 않는다.

```ts
const draftHandler = useScheduleDraft(cards, columns, onAdd);
```

### 🔹 테스트 시나리오

| 테스트 항목                              | 기대 결과                                              |
|------------------------------------------|--------------------------------------------------------|
| 이미 cardMode가 'create'인 카드가 있으면 | `onAdd`가 호출되지 않음                                |
| 클릭 위치에 따라 startTime이 계산됨     | 클릭 위치 → 비율 계산 → 시간 계산                     |
| columnId가 주어졌을 때 columnName 설정됨| columnId에 맞는 name이 draft에 포함됨                 |
| 생성된 draft가 onAdd로 전달됨            | 전체 데이터 형태가 `IScheduleCardData` 형태로 일치함 |

### 🔹 주요 포인트

- 셀의 `clientY`와 `getBoundingClientRect()`의 `top`을 통해 클릭 offset을 계산
- 이 값을 `60분` 기준으로 환산 → 5분 단위로 반올림
- 결과적으로 `startTime`, `endTime`이 계산되어 `onAdd(draft)` 호출

---

## ✅ 6. 다른 훅에 대한 확장 가능 예시

| 훅 이름             | 테스트 포인트 예시                                       |
|---------------------|----------------------------------------------------------|
| `useGridScrollSync` | 동기화된 ref에 스크롤 이벤트가 전달되는지               |
| `useAutoSaveDraft`  | 일정 시간 내 입력 없을 때 `onSave` 호출 여부             |
| `useProjectFilter`  | 필터 조건에 맞는 결과가 반환되는지                       |
| `useColumnCollapse` | collapse 상태 변경 후 내부 상태 및 클래스가 변경되는지  |

---

## ✅ 기타 팁

- 외부 종속이 많은 경우(시간, 날짜 등)는 `jest.useFakeTimers`, `vi.setSystemTime` 등을 사용
- 상태 변화 후 UI 업데이트가 필요한 경우엔 컴포넌트 테스트로 분리할 것
- `react-testing-library` 보단 `@testing-library/react-hooks` 또는 `vitest`의 `renderHook`을 주로 사용

---

> ✨ 커스텀 훅 테스트는 로직 단위로 "잘게 쪼개진 테스트"를 구성할 수 있게 해주며, UI와 무관한 순수 기능을 보장하는 데 가장 효과적입니다.

